app-id: io.cognusion.gnoll
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
    - org.freedesktop.Sdk.Extension.golang
command: gnoll

finish-args:
    - --share=ipc # Share IPC namespace with the host (necessary for X11).
    - --socket=x11
    - --device=dri # OpenGL rendering support.

    # Only needed if building with -tags wayland.
    #- --socket=wayland

    # Needed to support desktop notifications.
    - --talk-name=org.freedesktop.Notifications

    # Allowing access to the home directory as example.
    - --filesystem=home

build-options:
  env:
    - GOBIN=/app/bin
    - GOROOT=/usr/lib/sdk/golang

modules:
    - name: gnoll
      buildsystem: simple
      build-commands:
        - $GOROOT/bin/go build -v -trimpath -o gnoll
        - install -Dm00755 gnoll $FLATPAK_DEST/bin/gnoll
        - install -Dm00644 Icon.png $FLATPAK_DEST/share/icons/hicolor/256x256/apps/$FLATPAK_ID.png
        - install -Dm00644 $FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop
        - install -Dm00644 $FLATPAK_ID.appdata.xml $FLATPAK_DEST/share/appdata/$FLATPAK_ID.appdata.xml
      sources:
        - type: archive
          url: "https://github.com/cognusion/gnoll/archive/refs/tags/v1.0.3.tar.gz"
          sha256: b663803611d3cab1d49db650c776a7daf73757f97874846cff2a217e1c8357a1 # Update by running sha256sum on the file linked in the url.
        # Workaround for Go modules generated by github.com/dennwc/flatpak-go-mod
        - type: file
          path: modules.txt
          dest: vendor

        - type: archive
          url: https://proxy.golang.org/fyne.io/fyne/v2/@v/v2.4.2.zip
          strip-components: 3
          dest: vendor/fyne.io/fyne/v2
          sha256: a3783d61934295ba844b0065838867cbccf2e9cc4f084f2976e8288308ea9943

        - type: archive
          url: https://proxy.golang.org/fyne.io/systray/@v/v1.10.1-0.20231115130155-104f5ef7839e.zip
          strip-components: 2
          dest: vendor/fyne.io/systray
          sha256: 1f6b7f57de14c8240507f30f17a589c3573292a03b60d5f0c73c5f59f2efc346

        - type: archive
          url: https://proxy.golang.org/github.com/davecgh/go-spew/@v/v1.1.1.zip
          strip-components: 3
          dest: vendor/github.com/davecgh/go-spew
          sha256: 6b44a843951f371b7010c754ecc3cabefe815d5ced1c5b9409fb2d697e8a890d

        - type: archive
          url: https://proxy.golang.org/github.com/fredbi/uri/@v/v1.0.0.zip
          strip-components: 3
          dest: vendor/github.com/fredbi/uri
          sha256: cb4113e0a50457459147f09a18a49b0785693616312e87acf596f85a1171a010

        - type: archive
          url: https://proxy.golang.org/github.com/fsnotify/fsnotify/@v/v1.6.0.zip
          strip-components: 3
          dest: vendor/github.com/fsnotify/fsnotify
          sha256: 7d4408f12ffc38106e358244446851a28077ed80e3c0940e98e0e332b3ed43ab

        - type: archive
          url: https://proxy.golang.org/github.com/fyne-io/gl-js/@v/v0.0.0-20220119005834-d2da28d9ccfe.zip
          strip-components: 3
          dest: vendor/github.com/fyne-io/gl-js
          sha256: 6f810111e40b01d5fdfeb55c5659f61d43671614702b9bc273de8162e8e187f8

        - type: archive
          url: https://proxy.golang.org/github.com/fyne-io/glfw-js/@v/v0.0.0-20220120001248-ee7290d23504.zip
          strip-components: 3
          dest: vendor/github.com/fyne-io/glfw-js
          sha256: 5dee0bf04884b22b52dc5453ca1cf323a878deca43f5cfa1b5cc6e64612cd92e

        - type: archive
          url: https://proxy.golang.org/github.com/fyne-io/image/@v/v0.0.0-20220602074514-4956b0afb3d2.zip
          strip-components: 3
          dest: vendor/github.com/fyne-io/image
          sha256: d0ecdba4bced0978e1e3d95ef18c15433c54a39b6066cb814c99bd128ea64912

        - type: archive
          url: https://proxy.golang.org/github.com/go-gl/gl/@v/v0.0.0-20211210172815-726fda9656d6.zip
          strip-components: 3
          dest: vendor/github.com/go-gl/gl
          sha256: 25f3f14188565565b95bef7b955e1c6e0d06bccb90b2c598a078e9c73b6f66dd

        - type: archive
          url: https://proxy.golang.org/github.com/go-gl/glfw/v3.3/glfw/@v/v0.0.0-20231124074035-2de0cf0c80af.zip
          strip-components: 5
          dest: vendor/github.com/go-gl/glfw/v3.3/glfw
          sha256: 959a1c65923a615af978446d4fc716d94b1f890d9944e61cd4554ed829637b47

        - type: archive
          url: https://proxy.golang.org/github.com/go-text/render/@v/v0.0.0-20230619120952-35bccb6164b8.zip
          strip-components: 3
          dest: vendor/github.com/go-text/render
          sha256: 64c4d082cacaa0ad592cf6cbf081dad9301f3d8917b55dd09ac7d4f41a912d66

        - type: archive
          url: https://proxy.golang.org/github.com/go-text/typesetting/@v/v0.0.0-20230616162802-9c17dd34aa4a.zip
          strip-components: 3
          dest: vendor/github.com/go-text/typesetting
          sha256: ba5d70775b6480f3c8eb02740019f8258e0464069e14cd16819e631b6a90327c

        - type: archive
          url: https://proxy.golang.org/github.com/godbus/dbus/v5/@v/v5.1.0.zip
          strip-components: 4
          dest: vendor/github.com/godbus/dbus/v5
          sha256: 03dfa8e71089a6f477310d15c4d3a036d82d028532881b50fee254358e782ad9

        - type: archive
          url: https://proxy.golang.org/github.com/gopherjs/gopherjs/@v/v1.17.2.zip
          strip-components: 3
          dest: vendor/github.com/gopherjs/gopherjs
          sha256: 10a579f358ed01b90d8efa08878e7068b91bef929929f7c3532ffad3e20b7e67

        - type: archive
          url: https://proxy.golang.org/github.com/jsummers/gobmp/@v/v0.0.0-20151104160322-e2ba15ffa76e.zip
          strip-components: 3
          dest: vendor/github.com/jsummers/gobmp
          sha256: e142254da53879079ac599aec157ced1fae5e59d3e0e754303f4f5a0219a9b9d

        - type: archive
          url: https://proxy.golang.org/github.com/pmezard/go-difflib/@v/v1.0.0.zip
          strip-components: 3
          dest: vendor/github.com/pmezard/go-difflib
          sha256: de04cecc1a4b8d53e4357051026794bcbc54f2e6a260cfac508ce69d5d6457a0

        - type: archive
          url: https://proxy.golang.org/github.com/srwiley/oksvg/@v/v0.0.0-20221011165216-be6e8873101c.zip
          strip-components: 3
          dest: vendor/github.com/srwiley/oksvg
          sha256: d8e517dd8a48583bc32892a7c430dda165f79907b1fc9e3d49fe59a2894f587b

        - type: archive
          url: https://proxy.golang.org/github.com/srwiley/rasterx/@v/v0.0.0-20220730225603-2ab79fcdd4ef.zip
          strip-components: 3
          dest: vendor/github.com/srwiley/rasterx
          sha256: 4e76d6b2bd959c0ab7be2fbe1d9c454817e17d3d64ee49a7d78b1bddb7790a75

        - type: archive
          url: https://proxy.golang.org/github.com/stretchr/testify/@v/v1.8.4.zip
          strip-components: 3
          dest: vendor/github.com/stretchr/testify
          sha256: e206daaede0bd03de060bdfbeb984ac2c49b83058753fffc93fe0c220ea87532

        - type: archive
          url: https://proxy.golang.org/github.com/tevino/abool/@v/v1.2.0.zip
          strip-components: 3
          dest: vendor/github.com/tevino/abool
          sha256: 7e8ac7ac5a29815e5c0417e250810c5063bb169936c665c09aaa698f12425b09

        - type: archive
          url: https://proxy.golang.org/github.com/yuin/goldmark/@v/v1.5.5.zip
          strip-components: 3
          dest: vendor/github.com/yuin/goldmark
          sha256: 7e8148ce97e43af3e8307970cd597f3063b10daebdba176a0ecb7f682cd568b7

        - type: archive
          url: https://proxy.golang.org/golang.org/x/image/@v/v0.11.0.zip
          strip-components: 3
          dest: vendor/golang.org/x/image
          sha256: 061af32f13240595a5ec5c3c7340b66c3a05bb6725d386e6eb3850a5232fe45d

        - type: archive
          url: https://proxy.golang.org/golang.org/x/mobile/@v/v0.0.0-20230531173138-3c911d8e3eda.zip
          strip-components: 3
          dest: vendor/golang.org/x/mobile
          sha256: 71ec90785cd7dc32ccb4b58b56dd9a6ff0addf0f9d4f0468361ed3e71782c5ec

        - type: archive
          url: https://proxy.golang.org/golang.org/x/net/@v/v0.17.0.zip
          strip-components: 3
          dest: vendor/golang.org/x/net
          sha256: d99428e95af6fd8fdc23285d69b8f6e7c52c964c990295e45183718e33ebeb5a

        - type: archive
          url: https://proxy.golang.org/golang.org/x/sys/@v/v0.13.0.zip
          strip-components: 3
          dest: vendor/golang.org/x/sys
          sha256: 3d149afc9939980354374c0d47461dcdbd1d3980eb2f77e60304b23fee6f3d37

        - type: archive
          url: https://proxy.golang.org/golang.org/x/text/@v/v0.13.0.zip
          strip-components: 3
          dest: vendor/golang.org/x/text
          sha256: ed544fb017e967c053892df7b068612fce707ba32b57f35824cb041e31c6ae0f

        - type: archive
          url: https://proxy.golang.org/gopkg.in/yaml.v3/@v/v3.0.1.zip
          strip-components: 2
          dest: vendor/gopkg.in/yaml.v3
          sha256: aab8fbc4e6300ea08e6afe1caea18a21c90c79f489f52c53e2f20431f1a9a015

        - type: archive
          url: https://proxy.golang.org/honnef.co/go/js/dom/@v/v0.0.0-20210725211120-f030747120f2.zip
          strip-components: 4
          dest: vendor/honnef.co/go/js/dom
          sha256: 4470b3abd3e95f41705b43a3346570bc4d9beb2924fb1e70c7137502afb57bc2

